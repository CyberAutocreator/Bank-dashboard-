<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Secure Bank Interface</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{margin:0;font-family:Inter,-apple-system,Segoe UI,Roboto,Arial;background:#0b1220;color:#eaf2f7}
    .card{background:#0f1724;border-radius:12px;padding:22px;margin:20px auto;max-width:420px;box-shadow:0 10px 30px rgba(2,6,23,0.5)}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:#0a1422;color:#eaf2f7;margin-bottom:10px}
    .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,#0ea5a0,#06b6d4);color:#062b2b;font-weight:700}
    .btn-ghost{background:transparent;color:#9aa4b2;border:1px solid rgba(255,255,255,0.06)}
    .hidden{display:none}
    table{width:100%;border-collapse:collapse;font-size:0.9rem;margin-top:12px}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)}
    th{color:#9aa4b2;text-align:left}
    td.right{text-align:right}
  </style>
</head>
<body>
  <!-- LOGIN -->
  <section class="card" id="loginCard">
    <h2>Secure Login</h2>
    <input id="user" type="text" placeholder="Username"/>
    <input id="pass" type="password" placeholder="Password"/>
    <button class="btn btn-primary" onclick="login()">Login</button>
    <div id="loginError" style="color:#ef4444;display:none"></div>
  </section>

  <!-- DASHBOARD -->
  <section class="card hidden" id="dashboard">
    <h2 id="custName">Customer</h2>
    <div id="balances"></div>
    <button class="btn btn-primary" onclick="openTransfer()">Transfer Funds</button>
    <button class="btn btn-ghost" onclick="exportCsv()">Export CSV</button>
    <button class="btn btn-ghost" onclick="logout()">Logout</button>
    <h3>Transactions</h3>
    <table>
      <thead><tr><th>Date</th><th>Account</th><th>Type</th><th>Description</th><th class="right">Amount</th><th class="right">Balance</th></tr></thead>
      <tbody id="txBody"></tbody>
    </table>
  </section>

  <!-- Transfer Modal -->
  <section class="card hidden" id="transferCard">
    <h3>Transfer Funds</h3>
    <select id="fromAcc"></select>
    <select id="toAcc"></select>
    <input id="amt" type="number" placeholder="Amount"/>
    <button class="btn btn-primary" onclick="confirmTransfer()">Confirm</button>
    <button class="btn btn-ghost" onclick="closeTransfer()">Cancel</button>
    <div id="transferError" style="color:#ef4444;display:none"></div>
  </section>

<script>
const API = "https://your-backend.onrender.com"; // replace with your Render backend URL
let token = null;
let accountsCache = [];

async function login(){
  const username = document.getElementById('user').value.trim();
  const password = document.getElementById('pass').value.trim();
  try{
    const res = await fetch(API+"/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,password})});
    if(!res.ok) throw new Error("Invalid credentials");
    const data = await res.json();
    token = data.token;
    document.getElementById('custName').textContent = username;
    document.getElementById('loginCard').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');
    loadDashboard();
  }catch(e){ document.getElementById('loginError').textContent=e.message; document.getElementById('loginError').style.display='block'; }
}

async function loadDashboard(){
  const balRes = await fetch(API+"/api/balances",{headers:{Authorization:"Bearer "+token}});
  const {accounts} = await balRes.json();
  accountsCache = accounts;
  const balancesDiv = document.getElementById('balances'); balancesDiv.innerHTML="";
  let total=0;
  accounts.forEach(a=>{ balancesDiv.innerHTML+=`<div>${a.name}: ${formatUSD(a.balance)}</div>`; total+=a.balance; });
  balancesDiv.innerHTML+=`<strong>Total: ${formatUSD(total)}</strong>`;
  const txRes = await fetch(API+"/api/transactions",{headers:{Authorization:"Bearer "+token}});
  const {transactions} = await txRes.json();
  const tbody=document.getElementById('txBody'); tbody.innerHTML="";
  transactions.forEach(t=>{
    tbody.innerHTML+=`<tr><td>${new Date(t.date).toISOString().slice(0,10)}</td><td>${t.accountId}</td><td>${t.type}</td><td>${escapeHtml(t.description)}</td><td class="right">${formatUSD(t.amount)}</td><td class="right">${formatUSD(t.balanceAfter)}</td></tr>`;
  });
}

function openTransfer(){
  const fromSel=document.getElementById('fromAcc'); const toSel=document.getElementById('toAcc');
  fromSel.innerHTML=""; toSel.innerHTML="";
  accountsCache.forEach(a=>{ fromSel.innerHTML+=`<option value="${a.id}">${a.name}</option>`; toSel.innerHTML+=`<option value="${a.id}">${a.name}</option>`; });
  document.getElementById('transferCard').classList.remove('hidden');
}
function closeTransfer(){ document.getElementById('transferCard').classList.add('hidden'); }

async function confirmTransfer(){
  const fromId=document.getElementById('fromAcc').value;
  const toId=document.getElementById('toAcc').value;
  const amount=Number(document.getElementById('amt').value);
  try{
    const res=await fetch(API+"/api/transfer",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+token},body:JSON.stringify({fromId,toId,amount})});
    if(!res.ok) throw new Error((await res.json()).error);
    await loadDashboard();
    closeTransfer();
  }catch(e){ document.getElementById('transferError').textContent=e.message; document.getElementById('transferError').style.display='block'; }
}

function exportCsv(){
  window.open(API+"/api/transactions?format=csv","_blank");
}
function logout(){ token=null; document.getElementById('dashboard').classList.add('hidden'); document.getElementById('loginCard').classList.remove('hidden'); }
function formatUSD(n){ return Number(n).toLocaleString("en-US",{style:"currency",currency:"USD"}); }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
</script>
</body>
</html>
